# Our Journey - Reentry Support Chatbot

A React-based frontend application for Our Journey's chatbot system, designed to guide people returning from incarceration in North Carolina through the reentry process with personalized, verified resources.

## Table of Contents

- [Features](#features)
- [Architecture Overview](#architecture-overview)
- [Getting Started](#getting-started)
- [Project Structure](#project-structure)
- [Backend Integration](#backend-integration)
- [Deployment](#deployment)
- [Environment Variables](#environment-variables)
- [API Documentation](#api-documentation)

## Features

### Journey Jones (JoJo) Chat UI
- **Interactive Chatbot**: 24/7 conversational interface to help users navigate reentry resources
- **Language Support**: English and Spanish
- **Personalized Recommendations**: AI-powered guidance based on individual circumstances
- **Resource Database**: Statewide verified resources for housing, employment, healthcare, and legal aid
- **User Data Collection**: Captures location, release date, demographics for personalized assistance
- **Safety Features**: Flags dangerous/self-harm questions for human follow-up
- **Contact Collection**: Prompts for email/phone when human intervention is needed
- **Session Management**: Maintains conversation context throughout the chat

## Architecture Overview

### System Architecture

The application uses a serverless architecture on AWS:

- **Frontend**: React application hosted on AWS Amplify
- **Backend**: AWS Lambda functions with WebSocket API Gateway
- **Knowledge Base**: AWS Bedrock Knowledge Base with verified NC reentry resources
- **Deployment**: Automated via AWS CDK

### Why This Architecture?

- **Stateless Lambda, Stateful Conversations**: Lambda functions are serverless for demand-based usage
- **AI-Powered Responses**: AWS Bedrock provides intelligent, context-aware answers
- **Reliable Resource Matching**: Knowledge base ensures users get verified, up-to-date information
- **Crisis Detection**: Built-in safeguards to identify users in need of immediate support
- **Scalable**: Handles varying traffic loads from individuals
- **AWS Native**: Works seamlessly with Amplify + API Gateway


## Project Structure

```
OurJourney/
├── setup.sh                                    # Main deployment orchestration script
├── frontend_build.sh                           # Frontend build automation script
├── bedrock.sh                                  # Bedrock knowledge base setup script
│
├── our-journey/                                # Backend CDK Stack
│   ├── app.py                                  # CDK app entry point
│   ├── cdk.json                                # CDK configuration
│   ├── requirements.txt                        # Python dependencies
│   ├── our_journey/
│   │   ├── __init__.py
│   │   └── our_journey_stack.py               # Backend infrastructure definition
│   │       # Creates: WebSocket API, Lambda, Bedrock Knowledge Base, S3
│   └── lambdas/
│       └── lambda_function/
│           └── lambda_function.py             # Bedrock orchestration Lambda
│
├── our-journey-frontend/                      # Frontend CDK Stack
│   ├── app.py                                 # CDK app entry point
│   ├── cdk.json                               # CDK configuration
│   ├── requirements.txt                       # Python dependencies
│   ├── build.zip                              # Generated by frontend_build.sh (gitignored)
│   │
│   ├── our_journey_frontend/
│   │   ├── __init__.py
│   │   └── our_journey_frontend_stack.py     # Frontend infrastructure definition
│   │       # Creates: S3 bucket, Lambda, Custom Resource for Amplify
│   │
│   ├── lambdas/
│   │   └── amplify_deployment_lambda/         # Amplify deployment automation
│   │       ├── lambda_function.py             # CloudFormation custom resource handler
│   │       ├── utilities.py                   # Amplify operations (create/update/delete)
│   │       └── constants.py                   # Configuration constants
│   │
│   └── frontend/                              # React/Vite application
│       ├── package.json                       # npm dependencies
│       ├── vite.config.js                     # Vite build configuration
│       ├── index.html                         # HTML entry point
│       │
│       ├── src/
│       │   ├── main.jsx                       # Application entry point
│       │   └── app/
│       │       └── components/
│       │           ├── constants_backup.jsx   # Template with REPLACE_TOKEN
│       │           └── constants.jsx          # Generated with WebSocket URL
│       │
│       ├── dist/                              # Build output (generated, gitignored)
│       │   └── index.html                     # Built application
│       └── node_modules/                      # npm packages (gitignored)
```


## Backend Integration

The application uses WebSocket connections for real-time streaming chat. All WebSocket interactions are in `src/app/services/websocket.js`.

### WebSocket Communication

**Connection**: `wss://your-api-gateway-url/prod/`

**Send Message**:
```json
{
  "action": "sendMessage",
  "message": "I need help finding housing",
  "messages": [
    {"role": "user", "content": "Previous message"},
    {"role": "assistant", "content": "Previous response"}
  ],
  "userInfo": {
    "location": "Durham, NC",
    "releaseDate": "2024-01-15",
    "gender": "prefer_not_to_say",
    "over18": true,
    "language": "en"
  }
}
```

**Streaming Response Types**:
```json
// Message start
{"type": "messageStart"}

// Content streaming (multiple deltas)
{"type": "contentBlockDelta", "data": {"delta": {"text": "I can help..."}}}

// Info/status updates
{"type": "info", "data": {"message": "Heres some resources..."}}

// Message complete (closes connection)
{"type": "messageStop"}
```

**Usage**:
```javascript
import webSocketManager from './services/websocket';

await webSocketManager.sendMessageAndWaitForResponse(
  userMessage,
  chatHistory,
  (content, isNewMessage) => updateUI(content, isNewMessage),
  (info) => showStatus(info),
  () => enableInput(),
  userInfo
);
```


## Supported Languages

| Code | Language |
|------|----------|
| `en` | English (Default) |
| `es` | Spanish (Español) |

**Note**: Language selection affects all chatbot responses and UI elements.

## Features in Detail

### Chatbot Features

- **Resource Prioritization**: Our Journey resources shown first, followed by other verified NC resources
- **Personalized Guidance**: AI tailors responses based on user's location, release date, and needs
- **Crisis Detection**: Automatically identifies concerning language and prompts for help
- **Multi-step Collection**: Gathers user information progressively through conversation
- **Session Persistence**: Maintains context throughout the user's journey
- **Bilingual Support**: Full English and Spanish language support


## User Guide

### For Individuals Returning from Incarceration

1. **Starting a Conversation**:
   - Visit the Our Journey chatbot
   - Answer a few basic questions
   - Select English or Spanish
   - Say hello to Journey Jones (JoJo)
   - Answer initial questions about your situation

2. **Getting Help**:
   - Ask about housing, jobs, healthcare, or legal services
   - Mention your location (city or county in NC)
   - Be specific about your needs
   - JoJo will provide personalized resources

3. **Using Resources**:
   - Click on recommended resources for more details
   - Contact information is provided for each resource
   - Our Journey resources are prioritized
